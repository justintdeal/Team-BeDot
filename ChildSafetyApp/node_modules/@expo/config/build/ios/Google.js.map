{"version":3,"file":"Google.js","sourceRoot":"","sources":["../../src/ios/Google.ts"],"names":[],"mappings":"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","sourcesContent":["import fs from 'fs-extra';\nimport path from 'path';\nimport { XcodeProject } from 'xcode';\n\nimport { ExpoConfig } from '../Config.types';\nimport { ConfigPlugin } from '../Plugin.types';\nimport { createInfoPlistPlugin, withXcodeProject } from '../plugins/ios-plugins';\nimport { InfoPlist } from './IosConfig.types';\nimport { getSourceRoot } from './Paths';\nimport { appendScheme } from './Scheme';\nimport { addFileToGroup, getProjectName } from './utils/Xcodeproj';\n\nexport const withGoogle = createInfoPlistPlugin(setGoogleConfig);\n\nexport const withGoogleServicesFile: ConfigPlugin<void> = config => {\n  return withXcodeProject(config, config => {\n    config.modResults = setGoogleServicesFile(config, {\n      projectRoot: config.modRequest.projectRoot,\n      project: config.modResults,\n    });\n    return config;\n  });\n};\n\nexport function getGoogleMapsApiKey(config: Pick<ExpoConfig, 'ios'>) {\n  return config.ios?.config?.googleMapsApiKey ?? null;\n}\n\n// NOTE(brentvatne): if the developer has installed the google ads sdk and does\n// not provide an app id their app will crash. Standalone apps get around this by\n// providing some default value, we will instead here assume that the user can\n// do the right thing if they have installed the package. This is a slight discrepancy\n// that arises in ejecting because it's possible for the package to be installed and\n// not crashing in the managed workflow, then you eject and the app crashes because\n// you don't have an id to fall back to.\nexport function getGoogleMobileAdsAppId(config: Pick<ExpoConfig, 'ios'>) {\n  return config.ios?.config?.googleMobileAdsAppId ?? null;\n}\n\nexport function getGoogleSignInReservedClientId(config: Pick<ExpoConfig, 'ios'>) {\n  return config.ios?.config?.googleSignIn?.reservedClientId ?? null;\n}\n\nexport function getGoogleServicesFile(config: Pick<ExpoConfig, 'ios'>) {\n  return config.ios?.googleServicesFile ?? null;\n}\n\nexport function setGoogleMapsApiKey(\n  config: Pick<ExpoConfig, 'ios'>,\n  { GMSApiKey, ...infoPlist }: InfoPlist\n): InfoPlist {\n  const apiKey = getGoogleMapsApiKey(config);\n\n  if (apiKey === null) {\n    return infoPlist;\n  }\n\n  return {\n    ...infoPlist,\n    GMSApiKey: apiKey,\n  };\n}\n\nexport function setGoogleMobileAdsAppId(\n  config: Pick<ExpoConfig, 'ios'>,\n  { GADApplicationIdentifier, ...infoPlist }: InfoPlist\n): InfoPlist {\n  const appId = getGoogleMobileAdsAppId(config);\n\n  if (appId === null) {\n    return infoPlist;\n  }\n\n  return {\n    ...infoPlist,\n    GADApplicationIdentifier: appId,\n  };\n}\n\nexport function setGoogleSignInReservedClientId(\n  config: Pick<ExpoConfig, 'ios'>,\n  infoPlist: InfoPlist\n): InfoPlist {\n  const reservedClientId = getGoogleSignInReservedClientId(config);\n\n  if (reservedClientId === null) {\n    return infoPlist;\n  }\n\n  return appendScheme(reservedClientId, infoPlist);\n}\n\nexport function setGoogleConfig(config: Pick<ExpoConfig, 'ios'>, infoPlist: InfoPlist): InfoPlist {\n  infoPlist = setGoogleMapsApiKey(config, infoPlist);\n  infoPlist = setGoogleMobileAdsAppId(config, infoPlist);\n  infoPlist = setGoogleSignInReservedClientId(config, infoPlist);\n  return infoPlist;\n}\n\nexport function setGoogleServicesFile(\n  config: Pick<ExpoConfig, 'ios'>,\n  { projectRoot, project }: { project: XcodeProject; projectRoot: string }\n): XcodeProject {\n  const googleServicesFileRelativePath = getGoogleServicesFile(config);\n  if (googleServicesFileRelativePath === null) {\n    return project;\n  }\n\n  const googleServiceFilePath = path.resolve(projectRoot, googleServicesFileRelativePath);\n  fs.copyFileSync(\n    googleServiceFilePath,\n    path.join(getSourceRoot(projectRoot), 'GoogleService-Info.plist')\n  );\n\n  const projectName = getProjectName(projectRoot);\n  project = addFileToGroup(`${projectName}/GoogleService-Info.plist`, projectName, project);\n  return project;\n}\n"]}